<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CGNE processor</title>

    <script>
      function action() {
        alert("FINISHED!");
      }

      function cgneRequest(vector) {
        console.log(vector);

        request = new XMLHttpRequest();

        request.open("POST", "http://localhost:8001");
        request.setRequestHeader("Content-Length", "application/json");

        request.onload = action;

        request.send(JSON.stringify({ name: "oie_vem_browser", vector }));
      }

      function cgne() {
        console.log("CGNE iniciado.");

        const input = document.getElementById("fileinput");
        var fReader = new FileReader();
        fReader.readAsText(input.files[0]);
        fReader.onloadend = function (event) {
          const data = event.target.result;
          const vector = data.split("\n");

          let count = 1;
          const gained_vector = vector.map((signal) => {
            if (count > 794) {
              count = 1;
            }

            const number = Number(signal.replace(",", ""));

            const gamma = 100 + (1 / 20) * count * Math.sqrt(count);
            count++;

            return [gamma * number];
          });

          cgneRequest(gained_vector.slice(0, 50816));
        };
      }
    </script>
  </head>

  <body>
    Olá aqui você pode chamar o CGNE.

    <br />

    My action button: <button onclick="action()">ACTION!</button>

    <br />

    Selecione o arquivo de sinal: <input type="file" id="fileinput" />

    <br />

    Clique aqui para chamar o CGNE: <button onclick="cgne()">CGNE</button>
  </body>
</html>
